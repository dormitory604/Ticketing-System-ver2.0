# Copilot Instructions for client-app

- **Architecture**: Qt 6 C++ backend with Qt Quick/QML UI. Entry is QGuiApplication loading qrc:/qml/main.qml via QQmlApplicationEngine; QML gets a `qmlBridge` context property for all business calls (see [main_qml.cpp](main_qml.cpp#L9-L42)). Legacy Qt Widgets windows remain but are excluded from the build; treat them as reference only.
- **Build/Run**: Use CMake with Qt Quick/QuickControls2/Network. From repo root: `cmake -S . -B build` then `cmake --build build`. Run the built `client-app` in the chosen build dir.
- **Networking contract**: `NetworkManager` is the single TCP JSON client (see [network_manager.cpp](network_manager.cpp#L1-L220)). All requests include an `action` and `data` payload; responses include `status`, `message`, `action_response`, and optional `data`. A tag registration handshake runs on connect before any business request is allowed (`m_tagRegistered` gate). Pending actions are queued to match server replies. When adding a new API, define a sendXRequest method, emit the matching success/failure signals, and route in `onReadyRead`.
- **Server endpoint**: Default host/port is set in [main_qml.cpp](main_qml.cpp#L23-L25); update it when switching between cloud and local server. Connection errors surface through `generalError`.
- **Session handling**: `AppSession` is the single source of truth for the logged-in user (`user_id`, `username`, `is_admin`) with change signals (see [app_session.h](app_session.h#L6-L38)). `QmlBridge` updates this on login/profile update and clears it on logout.
- **QML bridge pattern**: `QmlBridge` exposes properties (`currentUsername`, `currentUserId`, `isLoggedIn`, `searchResults`, `myOrders`) and slots to call `NetworkManager` (see [qml_bridge.h](qml_bridge.h#L11-L83) and [qml_bridge.cpp](qml_bridge.cpp#L1-L180)). JSON arrays from the backend are converted to `QVariantList` for QML models. On success/failure, bridge emits typed signals consumed by QML.
- **UI flow**: [qml/main.qml](qml/main.qml#L1-L70) uses a `StackView` to swap Login → Register → Search, with Orders/Profile as pushes. Pages live in `qml/*.qml`; they accept a `bridge` property and listen for bridge signals via `Connections` (e.g., [qml/LoginWindow.qml](qml/LoginWindow.qml#L1-L120), [qml/SearchWindow.qml](qml/SearchWindow.qml#L1-L200)). Lists bind directly to `bridge.searchResults`/`myOrders`.
- **Resources**: QML files are bundled through [qml.qrc](qml.qrc); edits to QML require rebuild so the qrc regenerates. Keep new UI under `qml/` and add to the qrc.
- **Patterns for new features**: Add a send* method + signals in `NetworkManager`, mirror handlers in `QmlBridge` to update cached `QVariantList` and emit change signals, then bind in QML with `Connections` and list delegates. Maintain the `action` string consistency between request and response routing.
- **Internationalization**: Qt translation scaffolding exists (`client-app_en_US.ts`), loaded at startup in the legacy `main.cpp`; QML path currently uses the default locale without translation.

If anything here feels off or incomplete, tell me what to clarify or expand (e.g., server protocol details, QML page conventions, or build switches).
